/**
 * Table Data Parser
 * (This is the internal representation of tabular data used by jquery-visualize)
 */(function(e,t){function r(e,r){this.$table=t(e),this.options=t.extend({},n,r),t.fn.DataTable&&t.fn.DataTable.fnIsDataTable(this.$table.get(0))&&(this.dataTable=this.$table.dataTable()),this.parse(),this.$table.data("visualize-data",this)}var n={rowFilter:"*",colFilter:"*",parser:function(e){var n=t.trim(e),r=parseFloat(n);return isNaN(r)?n:r}};Array.max=function(e){return!e||e.length==0?undefined:Math.max.apply(Array,e)},Array.min=function(e){return!e||e.length==0?undefined:Math.min.apply(Array,e)},Array.sum=function(e){var t=e&&e.length?e.length:0,n=0,r;for(var i=0;i<t;i++)r=parseFloat(e[i]),n+=!e[i]||isNaN(e[i])?0:r;return n},Array.avg=function(e){var t=e&&e.length?e.length:0;return t?Array.sum(e)/t:0},Array.map=Array.prototype.map?function(e,t){return e.map(t)}:function(e,t){var n=e.length,r=new Array(n);for(var i=0;i<n;i++)r[i]=t(e[i]);return r},t.debounce=function(e,t){var t=t||250;return function(){var n=this,r=arguments;clearTimeout(e.hnd),e.hnd=setTimeout(function(){e.apply(n,r)},t)}},r.prototype={parse:function(){var e=this.options,n=e.rowFilter,r=e.colFilter,i=[],s=[],o=[],u=e.parser,a=t("thead tr",this.$table).get(0),f=this.dataTable?this.dataTable.$("tr",{filter:"applied"}):t("tbody tr",this.$table);t("td, th",a).each(function(e,n){o.push(t(n).text())}),f.filter(n).each(function(e,n){var a=[];t("th, td",n).filter(r).each(function(e,n){e==0&&n.tagName=="TH"?s.push(t(n).text()):a.push(u(t(n).text()))}),i.push(a);if(s.length>0){var f=i[0];o.length>f.length&&o.shift()}});var l=i.length,c=i[0].length,h=[];for(var p=0;p<c;p++){var d=[];for(var v=0;v<l;v++)d.push(i[v][p]);h.push(d)}this.lineHeaders=s,this.columnHeaders=o,this.lines=i,this.columns=h},get:function(e,t){var n=0,r=t.toLowerCase(),i=this[e.toLowerCase()=="columns"?"columnHeaders":"lineHeaders"];while(i[n]!==undefined&&i[n].toLowerCase()!=r)n++;return n<i.length?this[e][n]:[]}},e.TableData=r})(window,jQuery),function(e){function t(t,n){if(e.visualize.plugins[t])n(e.visualize.plugins[t]);else{var r="/plugins/jquery.visualize."+t.split(/[-_]/)[0]+".js";e.ajax({url:r,dataType:"script",async:!1,success:function(){if(!e.visualize.plugins[t])throw"Failed to load jquery.vizualize plugin "+t+" in following location : "+this.url+"\n";n(e.visualize.plugins[t])},error:function(e,n,r){throw"Failed to load jquery.vizualize plugin "+t+" in following location : "+this.url+"\n"+r.message}})}}function n(e){return e}function r(t){e.extend(this,t)}function i(e){var t=e.data(),n={};for(var r in t)if(r.indexOf("visualize")==0){var i=r.substr(9,1).toLowerCase()+r.substr(10);i=="options"?n=t[r]:n[i]=t[r]}return e.attr("width")&&(n.width=e.attr("width")),e.attr("height")&&(n.height=e.attr("height")),n}e.visualize={plugins:{}},e.visualize.getRangeLabels=function(e,t,n){var r=t-e,n=n>=r?r+1:n,i=n-1,s,o=[];o.push(e);for(var u=1;u<i;u++)s=e+r/i*u,Math.abs(s)<10?o.push(s%1==0?s:Math.ceil(s*100)/100):o.push(Math.floor(s));return o.push(t),o},r.prototype={keys:function(){return this._keys||[]},drawDateRange:function(t,n,r){if(typeof Date.add!="function")throw"This method is dependant on CalendarTools";var i=this.target.canvasContext,s=this.target.canvas,o=s.width(),u=s.height(),a=0,f=t,l=["Jan","Fev","Mar","Avr","Mai","Jun","Jui","Aou","Sep","Oct","Nov","Dec"],c=Date.elapsed("days",t,n)+1,h=c==0?o:o/c,p=function(e,t){i.beginPath(),i.lineWidth=[.1,2,3][t],i.moveTo(h*e,0),i.lineTo(h*e,u),i.strokeStyle=r.lineColors[t],i.stroke(),i.closePath()},d=function(e){i.beginPath(),i.lineWidth=h*2,i.moveTo(h*(e+1),0),i.lineTo(h*(e+1),u),i.strokeStyle=r.lineColors[3],i.stroke(),i.closePath()},v=e("<ul>").addClass("visualize-labels-x").width(o).height(u).insertBefore(s);while(f<=n){var m=f.getDate(),g=e("<span>").addClass("label").html(m);e("<li>").css("left",h*a).width(h).append(g).appendTo(v),(g.width()>h*(m<10?.5:.9)&&m%5&&m!=1||m==30&&g.width()>h*1.9)&&g.remove(),f.getDay()==6&&d(a),m==1?(g.append(e("<br>")).append(l[f.getMonth()]),f.getMonth()?p(a,1):(p(a,2),g.append(e("<br>")).append(f.getFullYear()))):p(a,0),f=Date.add(f,1,"day"),a++}},drawXAxis:function(t,r){var r=e.extend({},r),i=this.target.canvasContext,s=this.target.canvas,o=s.width(),u=s.height(),a=r.centerLabels!==undefined?r.centerLabels:isNaN(t[0]),f=r.drawLines!==undefined?r.drawLines:!a,l=r.format||n,c=t.length-(a?0:1),h=c==0?o:o/c,p=e("<ul>").addClass("visualize-labels visualize-labels-x").width(o).height(u).insertBefore(s);a?e.each(t,function(t,n){var r=e("<span>").addClass("label").css({width:"100%",textAlign:"center"}).html(l(n));e("<li>").css("left",h*t).width(h).append(r).appendTo(p)}):e.each(t,function(t,n){var r=e("<span>").addClass("label").html(l(n));e("<li>").css("left",h*t).width(h).append(r).appendTo(p),t>0&&r.css("margin-left",-0.5*r.width())}),f&&(i.beginPath(),i.lineWidth=.1,e.each(t,function(e,t){i.moveTo(h*(e+1),0),i.lineTo(h*(e+1),u)}),i.strokeStyle=this.options.lineColors[0],i.stroke(),i.closePath())},drawYAxis:function(t,r){var r=e.extend({},r),i=this.target.canvasContext,s=this.target.canvas,o=s.width(),u=s.height(),a=r.centerLabels!==undefined?r.centerLabels:isNaN(t[0]),f=r.drawLines!==undefined?r.drawLines:!a,l=r.format||n,c=t.length-(a?0:1),h=c==0?u:u/c,p=e("<ul>").addClass("visualize-labels visualize-labels-y").width(o).height(u).insertBefore(s);e.each(t,function(t,n){var i=e("<span>").addClass("label").html(l(n));e("<li>").css(r.fromTop?"top":"bottom",h*t+(a?h/2:0)).append(i).prependTo(p),i.css("margin-top",-0.5*i.height())}),f&&(i.beginPath(),i.lineWidth=.1,e.each(t,function(e,t){i.moveTo(0,h*(e+1)),i.lineTo(o,h*(e+1))}),i.strokeStyle=this.options.lineColors[0],i.stroke(),i.closePath())}};var s={type:"bar",appendTitle:!0,title:null,appendKey:!0,rowFilter:"*",colFilter:"*",colors:["#be1e2d","#666699","#92d5ea","#ee8310","#8d10ee","#5a3b16","#26a4ed","#f45a90","#e9e744"],lineColors:["#777","#aaa","#eee"],textColors:[],parseDirection:"x",lineWeight:4,barGroupMargin:10,barMargin:1,yLabelInterval:30};e.fn.visualizeColumns=function(t){var n=e(this);return n.each(function(){var n=e(this),r=e("thead th",n);r.each(function(r,s){var o=e(s).data("visualize-target");if(o){var u=e("#"+o),a=e.extend({},t,i(u));a.column=e(s).text(),a.visualizeColumns=!0,n.visualize(a,u)}})}),n},e.fn.visualize=function(n,o,u){typeof n!="string"&&(u=o,o=n||{},n=o.type||s.type);var a=e(this);return t(n,function(f){a.each(function(){var t=e(this),a=e.extend({},s,f.defaults,o,i(t));f.parser&&(a.parser=f.parser);var l=a.width=parseFloat(a.width||t.width()),c=a.height=parseFloat(a.height||t.height());a.ticks=+a.ticks||Math.ceil(c/a.yLabelInterval);var h=e("<canvas>").attr("height",c).attr("width",l),p=a.title||t.find("caption").text();a.column&&(p+=" ("+a.column+")");var d=(u||e("<div>")).addClass("visualize").addClass("visualize-"+n).attr("role","img").attr("aria-label","Chart representing data from the table: "+p).height(c).width(l).append(h);if(!u){var v=t.parent();d.insertAfter(v.hasClass("dataTables_wrapper")?v:t)}typeof G_vmlCanvasManager!="undefined"&&(G_vmlCanvasManager.init(),G_vmlCanvasManager.initElement(h[0]));var m=a.refresh?new TableData(t,a):t.data("visualize-data")||new TableData(t,a),g=new r({data:m,target:{container:d,canvas:h,canvasContext:h[0].getContext("2d")},options:a});t.data("visualize-data",m),f.apply(g);if(a.appendTitle||a.appendKey){var y=e("<div>").addClass("visualize-info").appendTo(d);a.appendTitle&&e("<div>").addClass("visualize-title").html(p).appendTo(y);if(a.appendKey){var b=e("<ul>").addClass("visualize-key");e.each(g.keys(),function(t,n){e("<li>").append(e("<span>").addClass("visualize-key-color").css("background",a.colors[t%a.colors.length])).append(e("<span>").addClass("visualize-key-label").html(n)).appendTo(b)}),b.appendTo(y)}}if(!d.data("visualize-bound")){t.on("filter",function(e,t){d.trigger("refresh")}),a.visualizeColumns||t.on("sort",function(n,r){var i=r.aaSorting[0][0],s=e(e("thead tr:first > *",t)[i]);a.column=s.text()});var w=e.debounce(function(){console.log("refresh!"),a.refresh=!0,t.visualize(n,a,d.empty())});d.on("refresh",w).data("visualize-bound",!0)}})}),a}}(jQuery),function(){var t={barGroupMargin:10,barMargin:1};$.visualize.plugins.bar=function(){var e=this.options,t=this.target.canvasContext,n=this.target.canvas,r=n.width(),i=n.height(),s=this.data;if(e.column){var o=s.get("columns",e.column),u=e.parseDirection=="x"?Array.map(o,function(e){return[e]}):[o],a=Math.ceil(Array.max(o)),f=Math.floor(Array.min(o)),l=a-(f>0?f=0:f),c=$.visualize.getRangeLabels(f,a,e.ticks),h=e.parseDirection=="x"?[e.column]:s.lineHeaders;this._keys=e.parseDirection=="x"?s.lineHeaders:[e.column]}else{var u=e.parseDirection=="x"?s.lines:s.columns,a=Math.ceil(Array.max($.map(u,Array.max))),f=Math.floor(Array.min($.map(u,Array.min))),l=a-(f>0?f=0:f),c=$.visualize.getRangeLabels(f,a,e.ticks),h=e.parseDirection=="x"?s.columnHeaders:s.lineHeaders;this._keys=e.parseDirection=="x"?s.lineHeaders:s.columnHeaders}this.drawXAxis(h),this.drawYAxis(c);var p=h.length!=0?r/h.length:r,d=l!=0?i/l:i,v=i-(f<0?-f:0)*d;for(var m=0;m<u.length;m++){t.strokeStyle=e.colors[m];var g=(p-e.barGroupMargin*2)/u.length;t.lineWidth=g-e.barMargin*2;var o=u[m];for(var y=0;y<o.length;y++){t.beginPath();var b=y*p+e.barGroupMargin+m*g+g/2;t.moveTo(b,v),t.lineTo(b,Math.round(-o[y]*d)+v),t.stroke(),t.closePath()}}},$.visualize.plugins.bar.defaults=t}(),function(){var t={width:250,height:250,pieMargin:20,pieLabelsAsPercent:!0,pieLabelPos:"inside",maxSlices:12},n=Math.PI*2,r=Math.PI*.5;$.visualize.plugins.pie=function(){var e=this.options,i=this.target.canvasContext,s=this.target.canvas,o=s.width()||t.width,u=s.height()||t.height,a=this.data,f=[],l=[],c;if(e.column){var h=a.get("columns",e.column),p=e.columnType||isNaN(h[0])?"text":"value",d={};$.each(h,function(e,t){p=="value"?d[a.lineHeaders[e]]=t:d[t]?d[t]+=1:d[t]=1});for(var v in d)l.push(v),f.push(d[v])}else e.parseDirection=="x"?(f=$.map(a.lines,Array.sum),l=a.lineHeaders):(f=$.map(a.columns,Array.sum),l=a.columnHeaders);f.length>e.maxSlices&&(l=["Cannot represent more than "+e.maxSlices+" values ("+f.length+")"],f=[100]),c=Array.sum(f),this._keys=l,e.pieLabelPos=="outside"&&this.target.container.addClass("visualize-pie-outside");var m=$('<ul class="visualize-labels"></ul>').insertAfter(s),g=Math.round(o/2),y=Math.round(u/2),b=y-e.pieMargin,w=0;$.each(f,function(t,s){var o=s<=0||isNaN(s)?0:s/c,u=w*n-r,a=(w+o)*n-r;o>0&&(i.beginPath(),i.moveTo(g,y),i.arc(g,y,b,u,a,!1),i.lineTo(g,y),i.closePath(),i.fillStyle=e.colors[t%e.colors.length],i.fill());var f=w+o/2,l=e.pieLabelPos=="inside"?b/1.6:b+b/5,h=Math.round(g+Math.sin(f*n)*l),p=Math.round(y-Math.cos(f*n)*l),d=h>g?"right":"left",v=p>y?"bottom":"top",E=parseFloat((o*100).toFixed(2));if(E){var S=e.pieLabelsAsPercent?E+"%":s,x=$('<span class="visualize-label">'+S+"</span>").css({leftRight:0,topBottom:0}),T=$('<li class="visualize-label-pos"></li>').append(x).appendTo(m).css({left:h,top:p});x.css("font-size",Math.min(b/10,20)).css("margin-"+d,-x.width()/2).css("margin-"+v,-x.outerHeight()/2),e.textColors[t]&&x.css("color",e.textColors[t])}w+=o})},$.visualize.plugins.pie.defaults=t}(),function(){var t=$.visualize.plugins.line=function(e){var t=$.extend({},this.options),n=this.target.canvasContext,r=this.target.canvas,i=r.width(),s=r.height(),o=this.data,u=t.parseDirection=="x"?o.lines:o.columns,a=Math.ceil(Array.max($.map(u,Array.max))),f=Math.floor(Array.min($.map(u,Array.min))),l=a-(f>0?f=0:f),c=$.visualize.getRangeLabels(f,a,t.ticks),h=l!=0?s/l:s,p=t.parseDirection=="x"?o.columnHeaders:o.lineHeaders,d=p.length!=1?i/(p.length-1):i;this._keys=t.parseDirection=="x"?o.lineHeaders:o.columnHeaders,this.drawXAxis(p,{centerLabels:!1}),this.drawYAxis(c),$.each(u,function(r,o){n.beginPath(),n.lineWidth=t.lineWeight,n.lineJoin="round",n.moveTo(0,s-h*o[0]);for(var u=0;u<o.length;u++)n.lineTo(d*u,s-h*o[u]);n.strokeStyle=t.colors[r],n.stroke(),e?(n.lineTo(i,s),n.lineTo(0,s),n.closePath(),n.fillStyle=t.colors[r],n.globalAlpha=.3,n.fill(),n.globalAlpha=1):n.closePath()})};$.visualize.plugins.area=function(){t.call(this,!0)}}(),function(){var t={normalize:!1,ticks:7};$.visualize.plugins.stack_100=function(){this.options.normalize=!0,this.options.ticks=5,n.call(this)};var n=$.visualize.plugins.stack=function(){var e=$.extend({},t,this.options),n=this.target.canvasContext,r=this.target.canvas,i=r.width(),s=r.height(),o=this.data,u=e.parseDirection=="x"?o.columns:o.lines,a=e.parseDirection=="x"?o.columnHeaders:o.lineHeaders,f=$.map(u,Array.sum),l=e.normalize?100:Array.max(f),c=$.visualize.getRangeLabels(0,l,e.ticks);this._keys=e.parseDirection=="x"?o.lineHeaders:o.columnHeaders,this.drawXAxis(a);var h=e.normalize?{format:function(e){return e+"%"}}:{};this.drawYAxis(c,h);var p=a.length!=0?i/a.length:i,d=l!=0?s/l:s;for(var v=0;v<u.length;v++){n.lineWidth=p-(e.barMargin+e.barGroupMargin)*2;var m=u[v],g=p*v+p/2,y=s,b=e.normalize?100/Array.sum(m):1;for(var w=0;w<m.length;w++){var E=Math.round(m[w]*d*b);n.beginPath(),n.strokeStyle=e.colors[w],n.moveTo(g,y),n.lineTo(g,y-E),n.stroke(),n.closePath(),y-=E}}}}(),function(){var t=$.visualize.plugins.hbar=function(){var e=this.options,t=this.target.canvasContext,n=this.target.canvas,r=n.width(),i=n.height(),s=this.data,o=e.parseDirection=="x"?s.lines:s.columns,u=Math.ceil(Array.max($.map(o,Array.max))),a=Math.floor(Array.min($.map(o,Array.min))),f=u-(a>0?a=0:a),l=$.visualize.getRangeLabels(a,u,e.ticks),c=e.parseDirection=="x"?s.columnHeaders:s.lineHeaders;this._keys=e.parseDirection=="x"?s.lineHeaders:s.columnHeaders,this.drawXAxis(l),this.drawYAxis(c,{drawLines:!0});var h=f!=0?r/f:r,p=c.length!=0?i/c.length:i,d=(a<0?-a:0)*h;for(var v=0;v<o.length;v++){t.beginPath();var m=(p-e.barGroupMargin*2)/o.length;t.lineWidth=m-e.barMargin*2;var g=o[v];for(var y=0;y<g.length;y++){var b=y*p+e.barGroupMargin+v*m+m/2;t.moveTo(d,b),t.lineTo(Math.round(g[y]*h)+d,b)}t.strokeStyle=e.colors[v],t.stroke(),t.closePath()}}}(),function(){var t={normalize:!1,ticks:7};$.visualize.plugins.hstack_100=function(){this.options.normalize=!0,this.options.ticks=5,n.call(this)};var n=$.visualize.plugins.hstack=function(){var e=$.extend({},t,this.options),n=this.target.canvasContext,r=this.target.canvas,i=r.width(),s=r.height(),o=this.data,u=e.parseDirection=="x"?o.lines:o.columns,a=$.map(u,Array.sum),f=e.normalize?100:Array.max(a),l=$.visualize.getRangeLabels(0,f,e.ticks),c=e.parseDirection=="x"?o.lineHeaders:o.columnHeaders;this._keys=e.parseDirection=="x"?tabledata.columnHeaders:tabledata.lineHeaders;var h=e.normalize?{format:function(e){return e+"%"}}:{};this.drawXAxis(l,h),this.drawYAxis(c);var p=f!=0?i/f:i,d=c.length!=0?s/c.length:s;for(var v=0;v<u.length;v++){n.lineWidth=d-(e.barMargin+e.barGroupMargin)*2;var m=u[v],g=0,y=s-d*v-d/2,b=e.normalize?100/Array.sum(m):1;for(var w=0;w<m.length;w++){var E=Math.round(m[w]*p*b);n.beginPath(),n.strokeStyle=e.colors[w],n.moveTo(g,y),n.lineTo(g+E,y),n.stroke(),n.closePath(),g+=E}}}}();